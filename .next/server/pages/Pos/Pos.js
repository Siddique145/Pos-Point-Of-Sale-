"use strict";(()=>{var e={};e.id=193,e.ids=[193,660],e.modules={6925:(e,t,i)=>{i.a(e,async(e,r)=>{try{i.r(t),i.d(t,{config:()=>q,default:()=>x,getServerSideProps:()=>h,getStaticPaths:()=>m,getStaticProps:()=>g,reportWebVitals:()=>y,routeModule:()=>b,unstable_getServerProps:()=>S,unstable_getServerSideProps:()=>P,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>j,unstable_getStaticProps:()=>f});var s=i(7093),n=i(5244),o=i(1323),a=i(5290),c=i.n(a),l=i(3802),d=i.n(l),u=i(5518),p=e([u]);u=(p.then?(await p)():p)[0];let x=(0,o.l)(u,"default"),g=(0,o.l)(u,"getStaticProps"),m=(0,o.l)(u,"getStaticPaths"),h=(0,o.l)(u,"getServerSideProps"),q=(0,o.l)(u,"config"),y=(0,o.l)(u,"reportWebVitals"),f=(0,o.l)(u,"unstable_getStaticProps"),j=(0,o.l)(u,"unstable_getStaticPaths"),v=(0,o.l)(u,"unstable_getStaticParams"),S=(0,o.l)(u,"unstable_getServerProps"),P=(0,o.l)(u,"unstable_getServerSideProps"),b=new s.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/Pos/Pos",pathname:"/Pos/Pos",bundlePath:"",filename:""},components:{App:d(),Document:c()},userland:u});r()}catch(e){r(e)}})},5518:(e,t,i)=>{i.a(e,async(e,r)=>{try{i.r(t),i.d(t,{default:()=>F});var s=i(997),n=i(6689),o=i.n(n),a=i(5965),c=i(9175),l=i(506),d=i(3857),u=i(3146),p=i(6723),x=i(6939),g=i(2428),m=i(227),h=i(8021),q=i(8993),y=i(928),f=i(5054),j=i(9529),v=i(3879),S=i(5342),P=i(3705),b=i(9369),k=i(7619),w=i(3826),C=i(1492),Z=i(4205),A=i(5158);i(5464);var D=i(401),I=e([C,Z,D,d,v]);[C,Z,D,d,v]=I.then?(await I)():I;let{Title:O,Text:R}=a.default,{Option:N}=c.default,{Header:$,Content:T,Footer:E}=l.default;(0,D.getAuth)();let _=o().memo(({saleItems:e,onQuantityChange:t,onDiscountChange:i,onDeleteItem:r})=>s.jsx(d.Z,{dataSource:e,columns:[{title:"ID",dataIndex:"id",key:"id",width:100},{title:"Item",dataIndex:"itemName",key:"itemName",width:200},{title:"Stock",dataIndex:"stock",key:"stock",width:100},{title:"TP (Trade Price)",dataIndex:"tpRate",key:"tpRate",width:100,render:e=>void 0!==e?`₹${e.toFixed(2)}`:"N/A"},{title:"Quantity",dataIndex:"quantity",key:"quantity",width:100,render:(e,i)=>s.jsx(u.Z,{id:i.id,min:1,max:i.stock,value:i.quantity,onChange:e=>t(i.id,e),disabled:0===i.stock})},{title:"Unit Price",dataIndex:"packRetailPrice",key:"packRetailPrice",width:100,render:e=>void 0!==e?`₹${e.toFixed(2)}`:"N/A"},{title:"Discount (%)",dataIndex:"discount",key:"discount",width:100,render:(e,t)=>s.jsx(u.Z,{min:0,max:100,value:t.discount,onChange:e=>i(t.id,e)})},{title:"Total",dataIndex:"totalAmount",key:"totalAmount",width:100,render:e=>void 0!==e?`₹${e.toFixed(2)}`:"N/A"},{title:"Action",key:"action",width:100,render:(e,t)=>s.jsx(p.ZP,{type:"text",danger:!0,icon:s.jsx(S.Z,{}),onClick:()=>r(t.id)})}],pagination:!1,rowKey:"id"}));function F(){let[e,t]=(0,n.useState)([]),[i,r]=(0,n.useState)([]),[o,a]=(0,n.useState)(1),[S,D]=(0,n.useState)(""),[I,F]=(0,n.useState)("cash"),[M,z]=(0,n.useState)(0),[L,Q]=(0,n.useState)(""),[U,K]=(0,n.useState)([]),[H,B]=(0,n.useState)(null),[V,Y]=(0,n.useState)(!1),[G,W]=(0,n.useState)(!1),X=(0,n.useRef)(null),J=async()=>{try{return(await (0,C.getDocs)((0,C.collection)(Z.db,"sales"))).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>t.createdAt.seconds-e.createdAt.seconds)}catch(e){return console.error("Error fetching saved invoices:",e),[]}},ee=e=>{if(0===e.stock){x.ZP.error("Item is out of stock");return}r(t=>t.find(t=>t.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+1,totalAmount:(t.quantity+1)*t.packRetailPrice*(1-t.discount/100)}:t):[...t,{...e,quantity:1,discount:0,totalAmount:e.packRetailPrice}]),Q("")},et=()=>{let e=i.reduce((e,t)=>e+t.quantity*t.packRetailPrice,0),t=i.reduce((e,t)=>e+t.quantity*t.packRetailPrice*(t.discount/100),0),r=i.reduce((e,t)=>e+(t.quantity||0),0),s=i.reduce((e,t)=>e+t.quantity*(t.tpRate||0),0);return{totalAmount:e,totalDiscount:t,totalQuantity:r,profit:e-t-s}},ei=async()=>{if(G)return;W(!0);let{profit:e}=et();if(e<0){x.ZP.error("Sale is in loss. Please adjust the quantities or prices to make a profit."),W(!1);return}try{let{totalAmount:t,totalDiscount:r,totalQuantity:s}=et(),n={invoiceNumber:o,customerNumber:S,items:i,totalAmount:t,totalDiscount:r,totalQuantity:s,profit:e,paymentMode:I,paymentAmount:M,change:M-(t-r),createdAt:(0,C.serverTimestamp)()};await (0,C.addDoc)((0,C.collection)(Z.db,"sales"),n),await Promise.all(i.map(async e=>{let t=(0,C.doc)(Z.db,"items",e.id);await (0,C.updateDoc)(t,{stock:e.stock-e.quantity})})),x.ZP.success("Sale saved successfully"),es(n),er(),W(!1)}catch(e){console.error("Error saving sale:",e),x.ZP.error("Failed to save sale"),W(!1)}},er=()=>{r([]),D(""),F("cash"),z(0),a(e=>e+1),Q(""),J()},es=e=>{let t=new A.jsPDF;t.setFontSize(18),t.text("M-Siddique Point of Sale",14,22),t.setFontSize(12),t.text(`Invoice #: ${e.invoiceNumber}`,14,30),t.text(`Customer #: ${e.customerNumber}`,14,38),t.text(`Date: ${new Date().toLocaleString()}`,14,46);let i=e.items.map(e=>[e.itemName,e.quantity,`₹${e.packRetailPrice.toFixed(2)}`,`${e.discount}%`,`₹${e.totalAmount.toFixed(2)}`]);t.autoTable({head:[["Item","Quantity","Price","Discount","Total"]],body:i,startY:60});let r=t.lastAutoTable.finalY+10;t.text(`Total Amount: ₹${e.totalAmount.toFixed(2)}`,14,r),t.text(`Discount: ₹${e.totalDiscount.toFixed(2)}`,14,r+8),t.text(`Paid: ₹${e.paymentAmount.toFixed(2)}`,14,r+16),t.text(`Change: ₹${e.change.toFixed(2)}`,14,r+24),t.save(`invoice_${e.invoiceNumber}.pdf`)},en=e.filter(e=>e.itemName.toLowerCase().includes(L.toLowerCase())),eo=async()=>{if(G)return;W(!0);let{profit:e}=et();if(e<0){x.ZP.error("Sale is in loss. Please adjust the quantities or prices to make a profit."),W(!1);return}try{let{totalAmount:t,totalDiscount:r,totalQuantity:s}=et(),n={invoiceNumber:o,customerNumber:S,items:i,totalAmount:t,totalDiscount:r,totalQuantity:s,profit:e,paymentMode:I,paymentAmount:M,change:M-(t-r),createdAt:(0,C.serverTimestamp)()},a=(0,C.doc)(Z.db,"sales",H.id);await (0,C.updateDoc)(a,n),x.ZP.success("Invoice updated successfully"),es(n),er(),W(!1)}catch(e){console.error("Error updating invoice:",e),x.ZP.error("Failed to update invoice"),W(!1)}},ea=e=>{es(e)};return(0,s.jsxs)(l.default,{style:{minHeight:"100vh"},children:[(0,s.jsxs)($,{style:{background:"#fff",padding:"0 20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(O,{level:2,children:"M-Siddique's Point of Sale"}),s.jsx(p.ZP,{type:"default",icon:s.jsx(P.Z,{}),onClick:()=>Y(!0),children:"Saved / Reprint"})]}),(0,s.jsxs)(T,{style:{padding:"20px",overflow:"auto"},children:[(0,s.jsxs)(g.Z,{children:[(0,s.jsxs)(m.Z,{gutter:[16,16],children:[s.jsx(h.Z,{span:8,children:(0,s.jsxs)(R,{strong:!0,children:["Invoice #: ",o]})}),s.jsx(h.Z,{span:8,children:s.jsx(q.Z,{placeholder:"Customer Number",value:S,onChange:e=>D(e.target.value)})}),s.jsx(h.Z,{span:8,children:s.jsx(R,{strong:!0,children:new Date().toLocaleString()})})]}),s.jsx(m.Z,{style:{marginTop:"20px"},children:s.jsx(h.Z,{span:24,children:s.jsx(y.Z,{style:{width:"100%"},options:en.map(e=>({value:e.itemName,label:`${e.itemName} - ₹${e.packRetailPrice.toFixed(2)}`})),onSelect:t=>{let i=e.find(e=>e.itemName===t);i&&ee(i)},onSearch:e=>{Q(e)},placeholder:"Search and select an item",children:s.jsx(q.Z,{suffix:s.jsx(b.Z,{})})})})}),s.jsx("div",{ref:X,style:{maxHeight:"400px",overflowY:"auto",marginTop:"20px"},children:s.jsx(_,{saleItems:i,onQuantityChange:(e,t)=>{t>0?r(i=>i.map(i=>i.id===e?{...i,quantity:t,totalAmount:t*i.packRetailPrice*(1-i.discount/100)}:i)):x.ZP.error("Quantity must be greater than 0")},onDiscountChange:(e,t)=>{t>=0&&t<=100?r(i=>i.map(i=>i.id===e?{...i,discount:t,totalAmount:i.quantity*i.packRetailPrice*(1-t/100)}:i)):x.ZP.error("Discount must be between 0 and 100")},onDeleteItem:e=>{r(t=>t.filter(t=>t.id!==e))}})}),s.jsx(E,{style:{position:"sticky",bottom:0,zIndex:1,padding:"10px 20px",background:"#f0f2f5"},children:(0,s.jsxs)(m.Z,{gutter:[16,16],justify:"space-between",align:"middle",children:[s.jsx(h.Z,{span:12,children:(0,s.jsxs)(f.Z,{direction:"horizontal",children:[(0,s.jsxs)(R,{strong:!0,children:["Total Items: ",i.length]}),(0,s.jsxs)(R,{strong:!0,children:["Total Quantity: ",et().totalQuantity]}),(0,s.jsxs)(R,{strong:!0,children:["Subtotal: ₹",et().totalAmount.toFixed(2)]}),(0,s.jsxs)(R,{strong:!0,children:["Discount: ₹",et().totalDiscount.toFixed(2)]}),(0,s.jsxs)(R,{strong:!0,children:["Finalized Total = ₹",(et().totalAmount-et().totalDiscount).toFixed(2)]}),(0,s.jsxs)(R,{strong:!0,children:["Profit: ₹",et().profit?.toFixed(2)||0]})]})}),s.jsx(h.Z,{span:12,children:(0,s.jsxs)(f.Z,{direction:"vertical",style:{width:"100%"},children:[(0,s.jsxs)(c.default,{style:{width:"100%"},value:I,onChange:e=>F(e),children:[s.jsx(N,{value:"cash",children:"Cash"}),s.jsx(N,{value:"card",children:"Card"})]}),s.jsx(u.Z,{style:{width:"100%"},value:M,onChange:e=>z(e),min:0,step:.01,formatter:e=>`₹ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/₹\s?|(,*)/g,"")}),(0,s.jsxs)(R,{strong:!0,children:["Change: ₹",Math.max(0,M-(et().totalAmount-et().totalDiscount)).toFixed(2)]}),s.jsx(p.ZP,{type:"primary",icon:s.jsx(k.Z,{}),onClick:H?eo:ei,disabled:0===i.length||M<et().totalAmount-et().totalDiscount||G,style:{width:"100%"},children:H?"Update Invoice":"Save and Print"}),H&&s.jsx(p.ZP,{type:"default",onClick:()=>{B(null),er()},style:{width:"100%",marginTop:"10px"},children:"Cancel"})]})})]})})]}),s.jsx(j.Z,{title:"Saved Invoices",placement:"right",onClose:()=>Y(!1),visible:V,width:400,children:s.jsx(d.Z,{dataSource:U,columns:[{title:"Invoice #",dataIndex:"invoiceNumber",key:"invoiceNumber"},{title:"Total Amount",dataIndex:"totalAmount",key:"totalAmount",render:e=>`₹${e.toFixed(2)}`},{title:"Date",dataIndex:"createdAt",key:"createdAt",render:e=>new Date(1e3*e.seconds).toLocaleString()},{title:"Action",key:"action",render:(e,t)=>s.jsx(s.Fragment,{children:s.jsx(p.ZP,{type:"link",icon:s.jsx(w.Z,{}),onClick:()=>ea(t)})})}],rowKey:"id",pagination:!1})}),G&&s.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx(v.Z,{size:"large"})})]})]})}r()}catch(e){r(e)}})},4053:e=>{e.exports=require("@ant-design/colors")},2727:e=>{e.exports=require("@ant-design/cssinjs")},45:e=>{e.exports=require("@ant-design/cssinjs-utils")},3071:e=>{e.exports=require("@ant-design/icons-svg/es/asn/DeleteOutlined")},4103:e=>{e.exports=require("@ant-design/icons-svg/es/asn/EditOutlined")},24:e=>{e.exports=require("@ant-design/icons-svg/es/asn/PrinterOutlined")},1874:e=>{e.exports=require("@ant-design/icons-svg/es/asn/SaveOutlined")},651:e=>{e.exports=require("@ant-design/icons-svg/es/asn/SearchOutlined")},8333:e=>{e.exports=require("@ant-design/icons/es/components/Context")},7669:e=>{e.exports=require("@ant-design/icons/es/icons/BarsOutlined")},6688:e=>{e.exports=require("@ant-design/icons/es/icons/CaretDownFilled")},6740:e=>{e.exports=require("@ant-design/icons/es/icons/CaretDownOutlined")},7341:e=>{e.exports=require("@ant-design/icons/es/icons/CaretUpOutlined")},4405:e=>{e.exports=require("@ant-design/icons/es/icons/CheckCircleFilled")},7150:e=>{e.exports=require("@ant-design/icons/es/icons/CheckOutlined")},8815:e=>{e.exports=require("@ant-design/icons/es/icons/CloseCircleFilled")},8737:e=>{e.exports=require("@ant-design/icons/es/icons/CloseOutlined")},9469:e=>{e.exports=require("@ant-design/icons/es/icons/CopyOutlined")},5896:e=>{e.exports=require("@ant-design/icons/es/icons/DoubleLeftOutlined")},9880:e=>{e.exports=require("@ant-design/icons/es/icons/DoubleRightOutlined")},1102:e=>{e.exports=require("@ant-design/icons/es/icons/DownOutlined")},5416:e=>{e.exports=require("@ant-design/icons/es/icons/EditOutlined")},7653:e=>{e.exports=require("@ant-design/icons/es/icons/EllipsisOutlined")},1119:e=>{e.exports=require("@ant-design/icons/es/icons/EnterOutlined")},5818:e=>{e.exports=require("@ant-design/icons/es/icons/ExclamationCircleFilled")},9825:e=>{e.exports=require("@ant-design/icons/es/icons/EyeInvisibleOutlined")},2488:e=>{e.exports=require("@ant-design/icons/es/icons/EyeOutlined")},6581:e=>{e.exports=require("@ant-design/icons/es/icons/FileOutlined")},6309:e=>{e.exports=require("@ant-design/icons/es/icons/FilterFilled")},2601:e=>{e.exports=require("@ant-design/icons/es/icons/FolderOpenOutlined")},1666:e=>{e.exports=require("@ant-design/icons/es/icons/FolderOutlined")},3047:e=>{e.exports=require("@ant-design/icons/es/icons/HolderOutlined")},6938:e=>{e.exports=require("@ant-design/icons/es/icons/InfoCircleFilled")},2121:e=>{e.exports=require("@ant-design/icons/es/icons/LeftOutlined")},7811:e=>{e.exports=require("@ant-design/icons/es/icons/LoadingOutlined")},8628:e=>{e.exports=require("@ant-design/icons/es/icons/MinusSquareOutlined")},4831:e=>{e.exports=require("@ant-design/icons/es/icons/PlusOutlined")},7961:e=>{e.exports=require("@ant-design/icons/es/icons/PlusSquareOutlined")},196:e=>{e.exports=require("@ant-design/icons/es/icons/RightOutlined")},3955:e=>{e.exports=require("@ant-design/icons/es/icons/SearchOutlined")},432:e=>{e.exports=require("@ant-design/icons/es/icons/UpOutlined")},566:e=>{e.exports=require("@ctrl/tinycolor")},8810:e=>{e.exports=require("@rc-component/color-picker")},9003:e=>{e.exports=require("classnames")},8887:e=>{e.exports=require("copy-to-clipboard")},5158:e=>{e.exports=require("jspdf")},5464:e=>{e.exports=require("jspdf-autotable")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},2090:e=>{e.exports=require("rc-checkbox")},5307:e=>{e.exports=require("rc-drawer")},9291:e=>{e.exports=require("rc-dropdown")},7118:e=>{e.exports=require("rc-field-form")},4326:e=>{e.exports=require("rc-input")},8724:e=>{e.exports=require("rc-input-number")},9934:e=>{e.exports=require("rc-menu")},4290:e=>{e.exports=require("rc-motion")},8858:e=>{e.exports=require("rc-notification")},3006:e=>{e.exports=require("rc-pagination")},3853:e=>{e.exports=require("rc-pagination/es/locale/en_US")},2815:e=>{e.exports=require("rc-picker/es/locale/en_US")},1493:e=>{e.exports=require("rc-resize-observer")},2463:e=>{e.exports=require("rc-select")},3345:e=>{e.exports=require("rc-table")},1890:e=>{e.exports=require("rc-table/es/hooks/useColumns")},5132:e=>{e.exports=require("rc-tabs")},8880:e=>{e.exports=require("rc-textarea")},3283:e=>{e.exports=require("rc-tooltip")},4593:e=>{e.exports=require("rc-tree")},6437:e=>{e.exports=require("rc-tree/es/util")},9011:e=>{e.exports=require("rc-tree/es/utils/conductUtil")},1839:e=>{e.exports=require("rc-tree/es/utils/treeUtil")},1601:e=>{e.exports=require("rc-util")},4248:e=>{e.exports=require("rc-util/es/Children/toArray")},3164:e=>{e.exports=require("rc-util/es/Dom/canUseDom")},943:e=>{e.exports=require("rc-util/es/Dom/dynamicCSS")},2947:e=>{e.exports=require("rc-util/es/Dom/isVisible")},8442:e=>{e.exports=require("rc-util/es/Dom/shadow")},6424:e=>{e.exports=require("rc-util/es/Dom/styleChecker")},2276:e=>{e.exports=require("rc-util/es/KeyCode")},3050:e=>{e.exports=require("rc-util/es/React/render")},1423:e=>{e.exports=require("rc-util/es/hooks/useLayoutEffect")},4187:e=>{e.exports=require("rc-util/es/hooks/useMemo")},5092:e=>{e.exports=require("rc-util/es/hooks/useMergedState")},2462:e=>{e.exports=require("rc-util/es/isEqual")},5514:e=>{e.exports=require("rc-util/es/omit")},2724:e=>{e.exports=require("rc-util/es/pickAttrs")},340:e=>{e.exports=require("rc-util/es/raf")},5927:e=>{e.exports=require("rc-util/es/ref")},9528:e=>{e.exports=require("rc-util/es/utils/set")},3966:e=>{e.exports=require("rc-util/es/warning")},6689:e=>{e.exports=require("react")},997:e=>{e.exports=require("react/jsx-runtime")},5315:e=>{e.exports=require("path")},3745:e=>{e.exports=import("firebase/app")},401:e=>{e.exports=import("firebase/auth")},1492:e=>{e.exports=import("firebase/firestore")},8592:e=>{e.exports=import("throttle-debounce")},4205:(e,t,i)=>{i.a(e,async(e,r)=>{try{i.d(t,{I:()=>l,db:()=>d});var s=i(3745),n=i(401),o=i(1492),a=e([s,n,o]);[s,n,o]=a.then?(await a)():a;let c=(0,s.initializeApp)({apiKey:"AIzaSyCuQ3wNmtDNAZMhZe9MRjpTn1kAvDp4SOA",authDomain:"point-of-sale-8a42d.firebaseapp.com",projectId:"point-of-sale-8a42d",storageBucket:"point-of-sale-8a42d.appspot.com",messagingSenderId:"283428202868",appId:"1:283428202868:web:0c99ca55251c4294136421",measurementId:"G-Q0928NKHEQ"}),l=(0,n.getAuth)(c),d=(0,o.getFirestore)(c);r()}catch(e){r(e)}})}};var t=require("../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[290,931,0,853,993,314,602,965,672],()=>i(6925));module.exports=r})();