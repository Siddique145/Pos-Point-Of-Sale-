"use strict";(()=>{var e={};e.id=655,e.ids=[655,660],e.modules={2315:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>q,default:()=>x,getServerSideProps:()=>h,getStaticPaths:()=>m,getStaticProps:()=>g,reportWebVitals:()=>y,routeModule:()=>P,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>b,unstable_getStaticParams:()=>S,unstable_getStaticPaths:()=>j,unstable_getStaticProps:()=>f});var s=r(7093),n=r(5244),o=r(1323),a=r(5290),c=r.n(a),l=r(3802),u=r.n(l),d=r(3450),p=e([d]);d=(p.then?(await p)():p)[0];let x=(0,o.l)(d,"default"),g=(0,o.l)(d,"getStaticProps"),m=(0,o.l)(d,"getStaticPaths"),h=(0,o.l)(d,"getServerSideProps"),q=(0,o.l)(d,"config"),y=(0,o.l)(d,"reportWebVitals"),f=(0,o.l)(d,"unstable_getStaticProps"),j=(0,o.l)(d,"unstable_getStaticPaths"),S=(0,o.l)(d,"unstable_getStaticParams"),v=(0,o.l)(d,"unstable_getServerProps"),b=(0,o.l)(d,"unstable_getServerSideProps"),P=new s.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/Pos/Posreturn",pathname:"/Pos/Posreturn",bundlePath:"",filename:""},components:{App:u(),Document:c()},userland:d});i()}catch(e){i(e)}})},3450:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{default:()=>O});var s=r(997),n=r(6689),o=r.n(n),a=r(5965),c=r(9175),l=r(506),u=r(3857),d=r(3146),p=r(6723),x=r(6939),g=r(2428),m=r(227),h=r(8021),q=r(8993),y=r(928),f=r(5054),j=r(9529),S=r(3879),v=r(5342),b=r(3705),P=r(9369),k=r(7619),w=r(3826),C=r(1492),Z=r(4205),D=r(5158);r(5464);var A=e([C,Z,u,S]);[C,Z,u,S]=A.then?(await A)():A;let{Title:F,Text:I}=a.default,{Option:R}=c.default,{Header:N,Content:T,Footer:$}=l.default,E=o().memo(({returnItems:e,onQuantityChange:t,onDiscountChange:r,onDeleteItem:i})=>s.jsx(u.Z,{dataSource:e,columns:[{title:"ID",dataIndex:"id",key:"id",width:100},{title:"Item",dataIndex:"itemName",key:"itemName",width:200},{title:"Stock",dataIndex:"stock",key:"stock",width:100},{title:"TP (Trade Price)",dataIndex:"tpRate",key:"tpRate",width:100,render:e=>void 0!==e?`₹${e.toFixed(2)}`:"N/A"},{title:"Quantity",dataIndex:"quantity",key:"quantity",width:100,render:(e,r)=>s.jsx(d.Z,{id:r.id,value:r.quantity,onChange:e=>t(r.id,e)})},{title:"Unit Price",dataIndex:"packRetailPrice",key:"packRetailPrice",width:100,render:e=>void 0!==e?`₹${e.toFixed(2)}`:"N/A"},{title:"Discount (%)",dataIndex:"discount",key:"discount",width:100,render:(e,t)=>s.jsx(d.Z,{min:0,max:100,value:t.discount,onChange:e=>r(t.id,e)})},{title:"Total",dataIndex:"totalAmount",key:"totalAmount",width:100,render:e=>void 0!==e?`₹${e.toFixed(2)}`:"N/A"},{title:"Action",key:"action",width:100,render:(e,t)=>s.jsx(p.ZP,{type:"text",danger:!0,icon:s.jsx(v.Z,{}),onClick:()=>i(t.id)})}],pagination:!1,rowKey:"id"}));function O(){let[e,t]=(0,n.useState)([]),[r,i]=(0,n.useState)([]),[o,a]=(0,n.useState)(1),[v,A]=(0,n.useState)(""),[O,_]=(0,n.useState)("cash"),[M,Q]=(0,n.useState)(0),[z,L]=(0,n.useState)(""),[U,K]=(0,n.useState)([]),[H,B]=(0,n.useState)(null),[V,Y]=(0,n.useState)(!1),[G,W]=(0,n.useState)(!1),X=(0,n.useRef)(null),J=async()=>{try{return(await (0,C.getDocs)((0,C.collection)(Z.db,"sales"))).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>t.createdAt.seconds-e.createdAt.seconds)}catch(e){return console.error("Error fetching saved invoices:",e),[]}},ee=e=>{i(t=>t.find(t=>t.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity-1,totalAmount:(t.quantity-1)*t.packRetailPrice*(1-t.discount/100)}:t):[...t,{...e,quantity:-1,discount:0,totalAmount:-e.packRetailPrice}]),L("")},et=()=>{let e=r.reduce((e,t)=>e+t.quantity*t.packRetailPrice,0),t=r.reduce((e,t)=>e+t.quantity*t.packRetailPrice*(t.discount/100),0),i=r.reduce((e,t)=>e+Math.abs(t.quantity||0),0),s=r.reduce((e,t)=>e+t.quantity*(t.tpRate||0),0);return{totalAmount:e,totalDiscount:t,totalQuantity:i,profit:e-t-s}},er=async()=>{if(G)return;W(!0);let{profit:e}=et();if(e>0){x.ZP.error("Sale is in loss. Please adjust the quantities or prices to make a profit."),W(!1);return}try{let{totalAmount:t,totalDiscount:i,totalQuantity:s}=et(),n={invoiceNumber:o,customerNumber:v,items:r,totalAmount:t,totalDiscount:i,totalQuantity:s,profit:e,paymentMode:O,paymentAmount:M,change:M-(t-i),createdAt:(0,C.serverTimestamp)()};await (0,C.addDoc)((0,C.collection)(Z.db,"returns"),n),await Promise.all(r.map(async e=>{let t=(0,C.doc)(Z.db,"items",e.id);await (0,C.updateDoc)(t,{stock:e.stock+Math.abs(e.quantity)})})),x.ZP.success("Return saved successfully"),es(n),ei(),W(!1)}catch(e){console.error("Error saving return:",e),x.ZP.error("Failed to save return"),W(!1)}},ei=()=>{i([]),A(""),_("cash"),Q(0),a(e=>e+1),L(""),J()},es=e=>{let t=new D.jsPDF;t.setFontSize(18),t.text("M-Siddique Return Point of Sale",14,22),t.setFontSize(12),t.text(`Invoice #: ${e.invoiceNumber}`,14,30),t.text(`Customer #: ${e.customerNumber}`,14,38),t.text(`Date: ${new Date().toLocaleString()}`,14,46);let r=e.items.map(e=>[e.itemName,e.quantity,`₹${e.packRetailPrice.toFixed(2)}`,`${e.discount}%`,`₹${e.totalAmount.toFixed(2)}`]);t.autoTable({head:[["Item","Quantity","Price","Discount","Total"]],body:r,startY:60});let i=t.lastAutoTable.finalY+10;t.text(`Total Amount: ₹${e.totalAmount.toFixed(2)}`,14,i),t.text(`Discount: ₹${e.totalDiscount.toFixed(2)}`,14,i+8),t.text(`Total Quantity: ${e.totalQuantity}`,14,i+8),t.save(`return_${e.invoiceNumber}.pdf`)},en=e.filter(e=>e.itemName.toLowerCase().includes(z.toLowerCase())),eo=async()=>{if(!G){W(!0);try{let{totalAmount:e,totalDiscount:t,totalQuantity:i}=et(),s={invoiceNumber:o,customerNumber:v,items:r,totalAmount:e,totalDiscount:t,totalQuantity:i,paymentMode:O,paymentAmount:M,createdAt:(0,C.serverTimestamp)()},n=(0,C.doc)(Z.db,"returns",H.id);await (0,C.updateDoc)(n,s),x.ZP.success("Return updated successfully"),es(s),ei(),W(!1)}catch(e){console.error("Error updating return:",e),x.ZP.error("Failed to update return"),W(!1)}}},ea=e=>{es(e)};return(0,s.jsxs)(l.default,{style:{minHeight:"100vh"},children:[(0,s.jsxs)(N,{style:{background:"#fff",padding:"0 20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(F,{level:2,children:"Return Point of Sale"}),s.jsx(p.ZP,{type:"default",icon:s.jsx(b.Z,{}),onClick:()=>Y(!0),children:"Saved / Reprint"})]}),(0,s.jsxs)(T,{style:{padding:"20px",overflow:"auto"},children:[(0,s.jsxs)(g.Z,{children:[(0,s.jsxs)(m.Z,{gutter:[16,16],children:[s.jsx(h.Z,{span:8,children:(0,s.jsxs)(I,{strong:!0,children:["Invoice #: ",o]})}),s.jsx(h.Z,{span:8,children:s.jsx(q.Z,{placeholder:"Customer Number",value:v,onChange:e=>A(e.target.value)})}),s.jsx(h.Z,{span:8,children:s.jsx(I,{strong:!0,children:new Date().toLocaleString()})})]}),s.jsx(m.Z,{style:{marginTop:"20px"},children:s.jsx(h.Z,{span:24,children:s.jsx(y.Z,{style:{width:"100%"},options:en.map(e=>({value:e.itemName,label:`${e.itemName} - ₹${e.packRetailPrice.toFixed(2)}`})),onSelect:t=>{let r=e.find(e=>e.itemName===t);r&&ee(r)},onSearch:e=>{L(e)},placeholder:"Search and select an item",children:s.jsx(q.Z,{suffix:s.jsx(P.Z,{})})})})}),s.jsx("div",{ref:X,style:{maxHeight:"400px",overflowY:"auto",marginTop:"20px"},children:s.jsx(E,{returnItems:r,onQuantityChange:(e,t)=>{t<0?i(r=>r.map(r=>r.id===e?{...r,quantity:t,totalAmount:t*r.packRetailPrice*(1-r.discount/100)}:r)):x.ZP.error("Quantity must be negative for returns")},onDiscountChange:(e,t)=>{t>=0&&t<=100?i(r=>r.map(r=>r.id===e?{...r,discount:t,totalAmount:r.quantity*r.packRetailPrice*(1-t/100)}:r)):x.ZP.error("Discount must be between 0 and 100")},onDeleteItem:e=>{i(t=>t.filter(t=>t.id!==e))}})}),s.jsx($,{style:{position:"sticky",bottom:0,zIndex:1,padding:"10px 20px",background:"#f0f2f5"},children:(0,s.jsxs)(m.Z,{gutter:[16,16],justify:"space-between",align:"middle",children:[s.jsx(h.Z,{span:12,children:(0,s.jsxs)(f.Z,{direction:"horizontal",children:[(0,s.jsxs)(I,{strong:!0,children:["Total Items: ",r.length]}),(0,s.jsxs)(I,{strong:!0,children:["Total Quantity: ",et().totalQuantity||0]}),(0,s.jsxs)(I,{strong:!0,children:["Subtotal: ₹",(et().totalAmount||0).toFixed(2)]}),(0,s.jsxs)(I,{strong:!0,children:["Discount: ₹",(et().totalDiscount||0).toFixed(2)]}),(0,s.jsxs)(I,{strong:!0,children:["Finalized Total = ₹",((et().totalAmount||0)-(et().totalDiscount||0)).toFixed(2)]}),(0,s.jsxs)(I,{strong:!0,children:["Profit: ₹",(et().profit||0).toFixed(2)]})]})}),s.jsx(h.Z,{span:12,children:(0,s.jsxs)(f.Z,{direction:"vertical",style:{width:"100%"},children:[(0,s.jsxs)(c.default,{style:{width:"100%"},value:O,onChange:e=>_(e),children:[s.jsx(R,{value:"cash",children:"Cash"}),s.jsx(R,{value:"card",children:"Card"})]}),s.jsx(d.Z,{style:{width:"100%"},value:M,onChange:e=>Q(e),min:0,step:.01,formatter:e=>`₹ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/₹\s?|(,*)/g,"")}),(0,s.jsxs)(I,{strong:!0,children:["Change: ₹",Math.max(0,M-(et().totalAmount-et().totalDiscount)).toFixed(2)]}),s.jsx(p.ZP,{type:"primary",icon:s.jsx(k.Z,{}),onClick:H?eo:er,disabled:0===r.length||M<et().totalAmount-et().totalDiscount||G,style:{width:"100%"},children:H?"Update Invoice":"Save and Print"}),H&&s.jsx(p.ZP,{type:"default",onClick:()=>{B(null),ei()},style:{width:"100%",marginTop:"10px"},children:"Cancel"})]})})]})})]}),s.jsx(j.Z,{title:"Saved Returns",placement:"right",onClose:()=>Y(!1),visible:V,width:400,children:s.jsx(u.Z,{dataSource:U,columns:[{title:"Invoice #",dataIndex:"invoiceNumber",key:"invoiceNumber"},{title:"Total Amount",dataIndex:"totalAmount",key:"totalAmount",render:e=>`₹${e.toFixed(2)}`},{title:"Date",dataIndex:"createdAt",key:"createdAt",render:e=>new Date(1e3*e.seconds).toLocaleString()},{title:"Action",key:"action",render:(e,t)=>s.jsx(s.Fragment,{children:s.jsx(p.ZP,{type:"link",icon:s.jsx(w.Z,{}),onClick:()=>ea(t)})})}],rowKey:"id",pagination:!1})}),G&&s.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx(S.Z,{size:"large"})})]})]})}i()}catch(e){i(e)}})},4053:e=>{e.exports=require("@ant-design/colors")},2727:e=>{e.exports=require("@ant-design/cssinjs")},45:e=>{e.exports=require("@ant-design/cssinjs-utils")},3071:e=>{e.exports=require("@ant-design/icons-svg/es/asn/DeleteOutlined")},4103:e=>{e.exports=require("@ant-design/icons-svg/es/asn/EditOutlined")},24:e=>{e.exports=require("@ant-design/icons-svg/es/asn/PrinterOutlined")},1874:e=>{e.exports=require("@ant-design/icons-svg/es/asn/SaveOutlined")},651:e=>{e.exports=require("@ant-design/icons-svg/es/asn/SearchOutlined")},8333:e=>{e.exports=require("@ant-design/icons/es/components/Context")},7669:e=>{e.exports=require("@ant-design/icons/es/icons/BarsOutlined")},6688:e=>{e.exports=require("@ant-design/icons/es/icons/CaretDownFilled")},6740:e=>{e.exports=require("@ant-design/icons/es/icons/CaretDownOutlined")},7341:e=>{e.exports=require("@ant-design/icons/es/icons/CaretUpOutlined")},4405:e=>{e.exports=require("@ant-design/icons/es/icons/CheckCircleFilled")},7150:e=>{e.exports=require("@ant-design/icons/es/icons/CheckOutlined")},8815:e=>{e.exports=require("@ant-design/icons/es/icons/CloseCircleFilled")},8737:e=>{e.exports=require("@ant-design/icons/es/icons/CloseOutlined")},9469:e=>{e.exports=require("@ant-design/icons/es/icons/CopyOutlined")},5896:e=>{e.exports=require("@ant-design/icons/es/icons/DoubleLeftOutlined")},9880:e=>{e.exports=require("@ant-design/icons/es/icons/DoubleRightOutlined")},1102:e=>{e.exports=require("@ant-design/icons/es/icons/DownOutlined")},5416:e=>{e.exports=require("@ant-design/icons/es/icons/EditOutlined")},7653:e=>{e.exports=require("@ant-design/icons/es/icons/EllipsisOutlined")},1119:e=>{e.exports=require("@ant-design/icons/es/icons/EnterOutlined")},5818:e=>{e.exports=require("@ant-design/icons/es/icons/ExclamationCircleFilled")},9825:e=>{e.exports=require("@ant-design/icons/es/icons/EyeInvisibleOutlined")},2488:e=>{e.exports=require("@ant-design/icons/es/icons/EyeOutlined")},6581:e=>{e.exports=require("@ant-design/icons/es/icons/FileOutlined")},6309:e=>{e.exports=require("@ant-design/icons/es/icons/FilterFilled")},2601:e=>{e.exports=require("@ant-design/icons/es/icons/FolderOpenOutlined")},1666:e=>{e.exports=require("@ant-design/icons/es/icons/FolderOutlined")},3047:e=>{e.exports=require("@ant-design/icons/es/icons/HolderOutlined")},6938:e=>{e.exports=require("@ant-design/icons/es/icons/InfoCircleFilled")},2121:e=>{e.exports=require("@ant-design/icons/es/icons/LeftOutlined")},7811:e=>{e.exports=require("@ant-design/icons/es/icons/LoadingOutlined")},8628:e=>{e.exports=require("@ant-design/icons/es/icons/MinusSquareOutlined")},4831:e=>{e.exports=require("@ant-design/icons/es/icons/PlusOutlined")},7961:e=>{e.exports=require("@ant-design/icons/es/icons/PlusSquareOutlined")},196:e=>{e.exports=require("@ant-design/icons/es/icons/RightOutlined")},3955:e=>{e.exports=require("@ant-design/icons/es/icons/SearchOutlined")},432:e=>{e.exports=require("@ant-design/icons/es/icons/UpOutlined")},566:e=>{e.exports=require("@ctrl/tinycolor")},8810:e=>{e.exports=require("@rc-component/color-picker")},9003:e=>{e.exports=require("classnames")},8887:e=>{e.exports=require("copy-to-clipboard")},5158:e=>{e.exports=require("jspdf")},5464:e=>{e.exports=require("jspdf-autotable")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},2090:e=>{e.exports=require("rc-checkbox")},5307:e=>{e.exports=require("rc-drawer")},9291:e=>{e.exports=require("rc-dropdown")},7118:e=>{e.exports=require("rc-field-form")},4326:e=>{e.exports=require("rc-input")},8724:e=>{e.exports=require("rc-input-number")},9934:e=>{e.exports=require("rc-menu")},4290:e=>{e.exports=require("rc-motion")},8858:e=>{e.exports=require("rc-notification")},3006:e=>{e.exports=require("rc-pagination")},3853:e=>{e.exports=require("rc-pagination/es/locale/en_US")},2815:e=>{e.exports=require("rc-picker/es/locale/en_US")},1493:e=>{e.exports=require("rc-resize-observer")},2463:e=>{e.exports=require("rc-select")},3345:e=>{e.exports=require("rc-table")},1890:e=>{e.exports=require("rc-table/es/hooks/useColumns")},5132:e=>{e.exports=require("rc-tabs")},8880:e=>{e.exports=require("rc-textarea")},3283:e=>{e.exports=require("rc-tooltip")},4593:e=>{e.exports=require("rc-tree")},6437:e=>{e.exports=require("rc-tree/es/util")},9011:e=>{e.exports=require("rc-tree/es/utils/conductUtil")},1839:e=>{e.exports=require("rc-tree/es/utils/treeUtil")},1601:e=>{e.exports=require("rc-util")},4248:e=>{e.exports=require("rc-util/es/Children/toArray")},3164:e=>{e.exports=require("rc-util/es/Dom/canUseDom")},943:e=>{e.exports=require("rc-util/es/Dom/dynamicCSS")},2947:e=>{e.exports=require("rc-util/es/Dom/isVisible")},8442:e=>{e.exports=require("rc-util/es/Dom/shadow")},6424:e=>{e.exports=require("rc-util/es/Dom/styleChecker")},2276:e=>{e.exports=require("rc-util/es/KeyCode")},3050:e=>{e.exports=require("rc-util/es/React/render")},1423:e=>{e.exports=require("rc-util/es/hooks/useLayoutEffect")},4187:e=>{e.exports=require("rc-util/es/hooks/useMemo")},5092:e=>{e.exports=require("rc-util/es/hooks/useMergedState")},2462:e=>{e.exports=require("rc-util/es/isEqual")},5514:e=>{e.exports=require("rc-util/es/omit")},2724:e=>{e.exports=require("rc-util/es/pickAttrs")},340:e=>{e.exports=require("rc-util/es/raf")},5927:e=>{e.exports=require("rc-util/es/ref")},9528:e=>{e.exports=require("rc-util/es/utils/set")},3966:e=>{e.exports=require("rc-util/es/warning")},6689:e=>{e.exports=require("react")},997:e=>{e.exports=require("react/jsx-runtime")},5315:e=>{e.exports=require("path")},3745:e=>{e.exports=import("firebase/app")},401:e=>{e.exports=import("firebase/auth")},1492:e=>{e.exports=import("firebase/firestore")},8592:e=>{e.exports=import("throttle-debounce")},4205:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{I:()=>l,db:()=>u});var s=r(3745),n=r(401),o=r(1492),a=e([s,n,o]);[s,n,o]=a.then?(await a)():a;let c=(0,s.initializeApp)({apiKey:"AIzaSyCuQ3wNmtDNAZMhZe9MRjpTn1kAvDp4SOA",authDomain:"point-of-sale-8a42d.firebaseapp.com",projectId:"point-of-sale-8a42d",storageBucket:"point-of-sale-8a42d.appspot.com",messagingSenderId:"283428202868",appId:"1:283428202868:web:0c99ca55251c4294136421",measurementId:"G-Q0928NKHEQ"}),l=(0,n.getAuth)(c),u=(0,o.getFirestore)(c);i()}catch(e){i(e)}})}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[290,931,0,853,993,314,602,965,672],()=>r(2315));module.exports=i})();