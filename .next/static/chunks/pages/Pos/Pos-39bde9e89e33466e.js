(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[193],{55330:function(t,e,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Pos/Pos",function(){return a(45518)}])},45518:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return E}});var i=a(85893),n=a(67294),o=a(80861),s=a(30258),r=a(30506),c=a(17503),d=a(70529),l=a(76964),u=a(38761),h=a(39816),x=a(10227),m=a(78021),p=a(32335),y=a(90928),f=a(35054),g=a(17636),j=a(70020),v=a(63291),k=a(61492),w=a(79631),P=a(12102),Z=a(32844),b=a(39828),S=a(94205),I=a(91819);a(18159);var A=a(91259);let{Title:C,Text:F}=o.default,{Option:N}=s.default,{Header:D,Content:q,Footer:T}=r.default;(0,A.v0)();let R=n.memo(t=>{let{saleItems:e,onQuantityChange:a,onDiscountChange:n,onDeleteItem:o}=t;return(0,i.jsx)(c.Z,{dataSource:e,columns:[{title:"ID",dataIndex:"id",key:"id",width:100},{title:"Item",dataIndex:"itemName",key:"itemName",width:200},{title:"Stock",dataIndex:"stock",key:"stock",width:100},{title:"TP (Trade Price)",dataIndex:"tpRate",key:"tpRate",width:100,render:t=>void 0!==t?"₹".concat(t.toFixed(2)):"N/A"},{title:"Quantity",dataIndex:"quantity",key:"quantity",width:100,render:(t,e)=>(0,i.jsx)(d.Z,{id:e.id,min:1,max:e.stock,value:e.quantity,onChange:t=>a(e.id,t),disabled:0===e.stock})},{title:"Unit Price",dataIndex:"packRetailPrice",key:"packRetailPrice",width:100,render:t=>void 0!==t?"₹".concat(t.toFixed(2)):"N/A"},{title:"Discount (%)",dataIndex:"discount",key:"discount",width:100,render:(t,e)=>(0,i.jsx)(d.Z,{min:0,max:100,value:e.discount,onChange:t=>n(e.id,t)})},{title:"Total",dataIndex:"totalAmount",key:"totalAmount",width:100,render:t=>void 0!==t?"₹".concat(t.toFixed(2)):"N/A"},{title:"Action",key:"action",width:100,render:(t,e)=>(0,i.jsx)(l.ZP,{type:"text",danger:!0,icon:(0,i.jsx)(v.Z,{}),onClick:()=>o(e.id)})}],pagination:!1,rowKey:"id"})});function E(){var t;let[e,a]=(0,n.useState)([]),[o,v]=(0,n.useState)([]),[A,E]=(0,n.useState)(1),[_,Q]=(0,n.useState)(""),[L,z]=(0,n.useState)("cash"),[J,M]=(0,n.useState)(0),[B,K]=(0,n.useState)(""),[U,H]=(0,n.useState)([]),[O,Y]=(0,n.useState)(null),[X,G]=(0,n.useState)(!1),[V,W]=(0,n.useState)(!1),$=(0,n.useRef)(null);(0,n.useEffect)(()=>{(async()=>{let t=await tt(),e=await te(),i=await ta();a(t),E(e),H(i)})()},[]),(0,n.useEffect)(()=>{let t=setInterval(async()=>{a(await tt())},1e3);return()=>clearInterval(t)},[]);let tt=async()=>{try{return(await (0,b.PL)((0,b.hJ)(S.db,"items"))).docs.map(t=>({id:t.id,...t.data()}))}catch(t){return console.error("Error fetching items:",t),u.ZP.error("Failed to load items"),[]}},te=async()=>{try{return(await (0,b.PL)((0,b.hJ)(S.db,"sales"))).docs.map(t=>t.data().invoiceNumber).reduce((t,e)=>Math.max(t,e),0)+1}catch(t){return console.error("Error fetching last invoice number:",t),1}},ta=async()=>{try{return(await (0,b.PL)((0,b.hJ)(S.db,"sales"))).docs.map(t=>({id:t.id,...t.data()})).sort((t,e)=>e.createdAt.seconds-t.createdAt.seconds)}catch(t){return console.error("Error fetching saved invoices:",t),[]}},ti=t=>{if(0===t.stock){u.ZP.error("Item is out of stock");return}v(e=>e.find(e=>e.id===t.id)?e.map(e=>e.id===t.id?{...e,quantity:e.quantity+1,totalAmount:(e.quantity+1)*e.packRetailPrice*(1-e.discount/100)}:e):[...e,{...t,quantity:1,discount:0,totalAmount:t.packRetailPrice}]),K("")},tn=()=>{let t=o.reduce((t,e)=>t+e.quantity*e.packRetailPrice,0),e=o.reduce((t,e)=>t+e.quantity*e.packRetailPrice*(e.discount/100),0);return{totalAmount:t,totalDiscount:e,totalQuantity:o.reduce((t,e)=>t+(e.quantity||0),0),profit:t-e-o.reduce((t,e)=>t+e.quantity*(e.tpRate||0),0)}},to=async()=>{if(V)return;W(!0);let{profit:t}=tn();if(t<0){u.ZP.error("Sale is in loss. Please adjust the quantities or prices to make a profit."),W(!1);return}try{let{totalAmount:e,totalDiscount:a,totalQuantity:i}=tn(),n={invoiceNumber:A,customerNumber:_,items:o,totalAmount:e,totalDiscount:a,totalQuantity:i,profit:t,paymentMode:L,paymentAmount:J,change:J-(e-a),createdAt:(0,b.Bt)()};await (0,b.ET)((0,b.hJ)(S.db,"sales"),n),await Promise.all(o.map(async t=>{let e=(0,b.JU)(S.db,"items",t.id);await (0,b.r7)(e,{stock:t.stock-t.quantity})})),u.ZP.success("Sale saved successfully"),tr(n),ts(),W(!1)}catch(t){console.error("Error saving sale:",t),u.ZP.error("Failed to save sale"),W(!1)}},ts=()=>{v([]),Q(""),z("cash"),M(0),E(t=>t+1),K(""),ta()},tr=t=>{let e=new I.jsPDF;e.setFontSize(18),e.text("M-Siddique Point of Sale",14,22),e.setFontSize(12),e.text("Invoice #: ".concat(t.invoiceNumber),14,30),e.text("Customer #: ".concat(t.customerNumber),14,38),e.text("Date: ".concat(new Date().toLocaleString()),14,46);let a=t.items.map(t=>[t.itemName,t.quantity,"₹".concat(t.packRetailPrice.toFixed(2)),"".concat(t.discount,"%"),"₹".concat(t.totalAmount.toFixed(2))]);e.autoTable({head:[["Item","Quantity","Price","Discount","Total"]],body:a,startY:60});let i=e.lastAutoTable.finalY+10;e.text("Total Amount: ₹".concat(t.totalAmount.toFixed(2)),14,i),e.text("Discount: ₹".concat(t.totalDiscount.toFixed(2)),14,i+8),e.text("Paid: ₹".concat(t.paymentAmount.toFixed(2)),14,i+16),e.text("Change: ₹".concat(t.change.toFixed(2)),14,i+24),e.save("invoice_".concat(t.invoiceNumber,".pdf"))},tc=e.filter(t=>t.itemName.toLowerCase().includes(B.toLowerCase())),td=async()=>{if(V)return;W(!0);let{profit:t}=tn();if(t<0){u.ZP.error("Sale is in loss. Please adjust the quantities or prices to make a profit."),W(!1);return}try{let{totalAmount:e,totalDiscount:a,totalQuantity:i}=tn(),n={invoiceNumber:A,customerNumber:_,items:o,totalAmount:e,totalDiscount:a,totalQuantity:i,profit:t,paymentMode:L,paymentAmount:J,change:J-(e-a),createdAt:(0,b.Bt)()},s=(0,b.JU)(S.db,"sales",O.id);await (0,b.r7)(s,n),u.ZP.success("Invoice updated successfully"),tr(n),ts(),W(!1)}catch(t){console.error("Error updating invoice:",t),u.ZP.error("Failed to update invoice"),W(!1)}},tl=t=>{tr(t)};return(0,i.jsxs)(r.default,{style:{minHeight:"100vh"},children:[(0,i.jsxs)(D,{style:{background:"#fff",padding:"0 20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)(C,{level:2,children:"M-Siddique's Point of Sale"}),(0,i.jsx)(l.ZP,{type:"default",icon:(0,i.jsx)(k.Z,{}),onClick:()=>G(!0),children:"Saved / Reprint"})]}),(0,i.jsxs)(q,{style:{padding:"20px",overflow:"auto"},children:[(0,i.jsxs)(h.Z,{children:[(0,i.jsxs)(x.Z,{gutter:[16,16],children:[(0,i.jsx)(m.Z,{span:8,children:(0,i.jsxs)(F,{strong:!0,children:["Invoice #: ",A]})}),(0,i.jsx)(m.Z,{span:8,children:(0,i.jsx)(p.Z,{placeholder:"Customer Number",value:_,onChange:t=>Q(t.target.value)})}),(0,i.jsx)(m.Z,{span:8,children:(0,i.jsx)(F,{strong:!0,children:new Date().toLocaleString()})})]}),(0,i.jsx)(x.Z,{style:{marginTop:"20px"},children:(0,i.jsx)(m.Z,{span:24,children:(0,i.jsx)(y.Z,{style:{width:"100%"},options:tc.map(t=>({value:t.itemName,label:"".concat(t.itemName," - ₹").concat(t.packRetailPrice.toFixed(2))})),onSelect:t=>{let a=e.find(e=>e.itemName===t);a&&ti(a)},onSearch:t=>{K(t)},placeholder:"Search and select an item",children:(0,i.jsx)(p.Z,{suffix:(0,i.jsx)(w.Z,{})})})})}),(0,i.jsx)("div",{ref:$,style:{maxHeight:"400px",overflowY:"auto",marginTop:"20px"},children:(0,i.jsx)(R,{saleItems:o,onQuantityChange:(t,e)=>{e>0?v(a=>a.map(a=>a.id===t?{...a,quantity:e,totalAmount:e*a.packRetailPrice*(1-a.discount/100)}:a)):u.ZP.error("Quantity must be greater than 0")},onDiscountChange:(t,e)=>{e>=0&&e<=100?v(a=>a.map(a=>a.id===t?{...a,discount:e,totalAmount:a.quantity*a.packRetailPrice*(1-e/100)}:a)):u.ZP.error("Discount must be between 0 and 100")},onDeleteItem:t=>{v(e=>e.filter(e=>e.id!==t))}})}),(0,i.jsx)(T,{style:{position:"sticky",bottom:0,zIndex:1,padding:"10px 20px",background:"#f0f2f5"},children:(0,i.jsxs)(x.Z,{gutter:[16,16],justify:"space-between",align:"middle",children:[(0,i.jsx)(m.Z,{span:12,children:(0,i.jsxs)(f.Z,{direction:"horizontal",children:[(0,i.jsxs)(F,{strong:!0,children:["Total Items: ",o.length]}),(0,i.jsxs)(F,{strong:!0,children:["Total Quantity: ",tn().totalQuantity]}),(0,i.jsxs)(F,{strong:!0,children:["Subtotal: ₹",tn().totalAmount.toFixed(2)]}),(0,i.jsxs)(F,{strong:!0,children:["Discount: ₹",tn().totalDiscount.toFixed(2)]}),(0,i.jsxs)(F,{strong:!0,children:["Finalized Total = ₹",(tn().totalAmount-tn().totalDiscount).toFixed(2)]}),(0,i.jsxs)(F,{strong:!0,children:["Profit: ₹",(null===(t=tn().profit)||void 0===t?void 0:t.toFixed(2))||0]})]})}),(0,i.jsx)(m.Z,{span:12,children:(0,i.jsxs)(f.Z,{direction:"vertical",style:{width:"100%"},children:[(0,i.jsxs)(s.default,{style:{width:"100%"},value:L,onChange:t=>z(t),children:[(0,i.jsx)(N,{value:"cash",children:"Cash"}),(0,i.jsx)(N,{value:"card",children:"Card"})]}),(0,i.jsx)(d.Z,{style:{width:"100%"},value:J,onChange:t=>M(t),min:0,step:.01,formatter:t=>"₹ ".concat(t).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/₹\s?|(,*)/g,"")}),(0,i.jsxs)(F,{strong:!0,children:["Change: ₹",Math.max(0,J-(tn().totalAmount-tn().totalDiscount)).toFixed(2)]}),(0,i.jsx)(l.ZP,{type:"primary",icon:(0,i.jsx)(P.Z,{}),onClick:O?td:to,disabled:0===o.length||J<tn().totalAmount-tn().totalDiscount||V,style:{width:"100%"},children:O?"Update Invoice":"Save and Print"}),O&&(0,i.jsx)(l.ZP,{type:"default",onClick:()=>{Y(null),ts()},style:{width:"100%",marginTop:"10px"},children:"Cancel"})]})})]})})]}),(0,i.jsx)(g.Z,{title:"Saved Invoices",placement:"right",onClose:()=>G(!1),visible:X,width:400,children:(0,i.jsx)(c.Z,{dataSource:U,columns:[{title:"Invoice #",dataIndex:"invoiceNumber",key:"invoiceNumber"},{title:"Total Amount",dataIndex:"totalAmount",key:"totalAmount",render:t=>"₹".concat(t.toFixed(2))},{title:"Date",dataIndex:"createdAt",key:"createdAt",render:t=>new Date(1e3*t.seconds).toLocaleString()},{title:"Action",key:"action",render:(t,e)=>(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(l.ZP,{type:"link",icon:(0,i.jsx)(Z.Z,{}),onClick:()=>tl(e)})})}],rowKey:"id",pagination:!1})}),V&&(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,i.jsx)(j.Z,{size:"large"})})]})]})}},94205:function(t,e,a){"use strict";a.d(e,{I:function(){return r},db:function(){return c}});var i=a(83977),n=a(91259),o=a(39828);let s=(0,i.ZF)({apiKey:"AIzaSyCuQ3wNmtDNAZMhZe9MRjpTn1kAvDp4SOA",authDomain:"point-of-sale-8a42d.firebaseapp.com",projectId:"point-of-sale-8a42d",storageBucket:"point-of-sale-8a42d.appspot.com",messagingSenderId:"283428202868",appId:"1:283428202868:web:0c99ca55251c4294136421",measurementId:"G-Q0928NKHEQ"}),r=(0,n.v0)(s),c=(0,o.ad)(s)}},function(t){t.O(0,[16,257,847,837,825,761,335,417,292,861,672,888,774,179],function(){return t(t.s=55330)}),_N_E=t.O()}]);